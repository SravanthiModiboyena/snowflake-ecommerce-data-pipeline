USE DATABASE ECOM_DB;
USE SCHEMA RAW;

-- Create Stream
CREATE OR REPLACE STREAM SALES_STREAM
ON TABLE SALES_RAW;

-- Create Task
CREATE OR REPLACE TASK SILVER_TASK
WAREHOUSE = ECOM_WH
SCHEDULE = '1 MINUTE'
AS
INSERT INTO ECOM_DB.SILVER.SALES_CLEAN
SELECT
    ORDER_ID,
    PRODUCT_ID,
    QUANTITY,
    PRICE,
    ORDER_DATE
FROM SALES_STREAM
WHERE METADATA$ACTION = 'INSERT';

-- Start Task
ALTER TASK SILVER_TASK RESUME;
